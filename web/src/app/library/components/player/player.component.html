<div class="player">
  <div class="back-metadata">
    <button mat-button mat-icon-button class="back" (click)="previous.emit()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="metadata">
      <span class="title" [matTooltip]="currentTrack ? currentTrack.title : ''">
        {{ currentTrack ? currentTrack.title : '' }}
      </span>
      <span class="artist" [matTooltip]="currentTrack ? currentTrack.artist : ''">
        {{ currentTrack ? currentTrack.artist : '' }}
      </span>
    </div>
    <button mat-button mat-icon-button
            class="mute"
            (click)="setMuted(!muted)"
            [disabled]="viewLoading">
      <mat-icon *ngIf="!muted && volume > 0.50">volume_up</mat-icon>
      <mat-icon *ngIf="!muted && volume > 0 && volume <= 0.50">volume_down</mat-icon>
      <mat-icon *ngIf="!muted && volume == 0">volume_mute</mat-icon>
      <mat-icon *ngIf="muted">volume_off</mat-icon>
    </button>
  </div>
  <div class="volume">
    <mat-slider
      [disabled]="muted || viewLoading"
      [value]="volume"
      (input)="setVolume($event.value)"
      [max]="1"
      [step]="0.01"
      color="primary"></mat-slider>
    <button mat-button mat-icon-button
            class="mute"
            (click)="setMuted(!muted)">
      <mat-icon *ngIf="!muted && volume > 0.50">volume_up</mat-icon>
      <mat-icon *ngIf="!muted && volume > 0 && volume <= 0.50">volume_down</mat-icon>
      <mat-icon *ngIf="!muted && volume == 0">volume_mute</mat-icon>
      <mat-icon *ngIf="muted">volume_off</mat-icon>
    </button>
  </div>
  <div class="carousel">
    <mat-tab-group #carousel [(selectedIndex)]="selectedCarouselIndex">
      <mat-tab label="Playlist">
        <ng-template mat-tab-label>
          <mat-icon>playlist_play</mat-icon>
          <span>Playlist</span>
        </ng-template>
        <app-loader [show]="viewLoading"></app-loader>
        <mat-list *ngIf="smallScreen && !viewLoading" class="playlist" (swipeleft)="swipeLeft()" (swiperight)="swipeRight()" #playlistMatList>
          <ng-container *ngFor="let track of playlist; trackBy: trackByURL">
            <div #listItem [attr.data-url]="track.url" class="track-list-item divider">
              <mat-list-item class="hover"
                             [class.current]="isTrackCurrent(track)"
                             (click)="playTrack(track)">
                <span matLine class="title">
                  <mat-icon *ngIf="isTrackCurrent(track) && playing">equalizer</mat-icon>
                  <span>{{ track.title }}</span>
                </span>
                <span matLine class="meta">
                  {{ track.artist }} â€¢ {{ track.album }}
                </span>
                <!--<span class="year">{{ track.year }}</span>-->
                <span class="duration">{{ track.duration | sgTime }}</span>
              </mat-list-item>
            </div>
          </ng-container>
        </mat-list>
        <ul *ngIf="!smallScreen && !viewLoading" class="playlist-long" (swipeleft)="swipeLeft()" (swiperight)="swipeRight()" #playlistUl>
          <ng-container *ngFor="let track of playlist; trackBy: trackByURL">
            <li #listItem [class.current]="isTrackCurrent(track)" class="divider track-list-item" (click)="playTrack(track)" [attr.data-url]="track.url">
              <span class="title c">
                <mat-icon *ngIf="isTrackCurrent(track) && playing">equalizer</mat-icon>
                <span [matTooltip]="track.title">{{ track.title }}</span>
              </span>
              <span class="artist c" [matTooltip]="track.artist">{{ track.artist }}</span>
              <span class="album c" [matTooltip]="track.album">{{ track.album }}</span>
              <span class="year c">{{ track.year | sgYear }}</span>
              <span class="duration c">{{ track.duration | sgTime }}</span>
            </li>
          </ng-container>
          <li class="status-bar">
            <span class="status-total-time">Total duration: {{ getTotalDuration() | sgTime }}</span>
          </li>
        </ul>
      </mat-tab>
      <mat-tab label="Cover">
        <ng-template mat-tab-label>
          <mat-icon>photo</mat-icon>
          <span>Cover</span>
        </ng-template>
        <div class="albumArt" (swipeleft)="swipeLeft()" (swiperight)="swipeRight()">
          <img *ngIf="currentTrack && currentTrack.coverUrl" src="{{ currentTrack.coverUrl }}" alt="Album Cover" />
          <mat-icon *ngIf="!currentTrack || !currentTrack.coverUrl">music_note</mat-icon>
        </div>
      </mat-tab>
      <mat-tab label="Lyrics" >
        <ng-template mat-tab-label>
          <mat-icon>format_align_center</mat-icon>
          <span>Lyrics</span>
        </ng-template>
        <div class="lyrics"
             #lyricsDiv
             *ngIf="lyrics !== null || showError == false"
             (swipeleft)="swipeLeft()"
             (swiperight)="swipeRight()"
             [attr.contenteditable]="!smallScreen"
             spellcheck="false"
             (blur)="lyricsEdited($event)"
             (paste)="lyricsPasted($event)"
             (keydown)="onKeyDown($event)">{{ lyrics }}</div>
        <div class="lyrics error"
             *ngIf="lyricsError && showError"
             (click)="errorClicked()"
             (swipeleft)="swipeLeft()"
             (swiperight)="swipeRight()">
          {{ lyricsError }}<br>
          <span *ngIf="!smallScreen">You can copy/paste some lyrics here.</span>
        </div>
        <div class="lyrics loading" *ngIf="lyr